<!DOCTYPE html>
<html>
<head>
    <title>Pixel Place</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #container { position: relative; width: 100vw; height: 100vh; }
        #canvas { position: absolute; background: #eee; }
        #toolbar {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: 100px; background: #333; padding: 10px;
            display: flex; align-items: center;
        }
        #color-preview { width: 50px; height: 50px; border: 2px solid white; margin-right: 15px; }
        .slider { margin: 0 10px; width: 100px; }
        .value { color: white; width: 30px; text-align: center; }
        #zoom-controls { position: fixed; top: 10px; right: 10px; background: rgba(255,255,255,0.7); padding: 5px; }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="canvas"></canvas>
        <div id="zoom-controls">
            <button id="zoom-out">-</button>
            <span id="zoom-level">100%</span>
            <button id="zoom-in">+</button>
        </div>
    </div>
    
    <div id="toolbar">
        <div id="color-preview"></div>
        <div>
            <span style="color:red">R</span>
            <input type="range" class="slider" id="red" min="0" max="255" value="0">
            <span class="value" id="red-value">0</span>
        </div>
        <div>
            <span style="color:green">G</span>
            <input type="range" class="slider" id="green" min="0" max="255" value="0">
            <span class="value" id="green-value">0</span>
        </div>
        <div>
            <span style="color:blue">B</span>
            <input type="range" class="slider" id="blue" min="0" max="255" value="0">
            <span class="value" id="blue-value">0</span>
        </div>
        <div id="hex" style="color:white; margin-left:15px;">#000000</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDn5odm1PQYXKC9tk_ad_3sPddQf9cEEmY",
            authDomain: "pixel-place-1.firebaseapp.com",
            databaseURL: "https://pixel-place-1-default-rtdb.firebaseio.com",
            projectId: "pixel-place-1",
            storageBucket: "pixel-place-1.appspot.com",
            messagingSenderId: "48366213367",
            appId: "1:48366213367:web:0a8bab14f054ddcf6a5bf2",
            measurementId: "G-KFPY6HFNDK"
        };
        
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();
        
        // Canvas setup
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('container');
        
        const GRID_SIZE = 10000;
        const BASE_PIXEL_SIZE = 10;
        canvas.width = GRID_SIZE * BASE_PIXEL_SIZE;
        canvas.height = GRID_SIZE * BASE_PIXEL_SIZE;
        
        // View state
        let scale = 1;
        let offsetX = 0;
        let offsetY = 0;
        let isDragging = false;
        let lastX, lastY;
        
        // Drawing state
        let currentColor = '#000000';
        let isDrawing = false;
        
        // UI elements
        const colorPreview = document.getElementById('color-preview');
        const redSlider = document.getElementById('red');
        const greenSlider = document.getElementById('green');
        const blueSlider = document.getElementById('blue');
        const redValue = document.getElementById('red-value');
        const greenValue = document.getElementById('green-value');
        const blueValue = document.getElementById('blue-value');
        const hexDisplay = document.getElementById('hex');
        const zoomLevel = document.getElementById('zoom-level');
        
        // Update color from sliders
        function updateColor() {
            const r = parseInt(redSlider.value).toString(16).padStart(2, '0');
            const g = parseInt(greenSlider.value).toString(16).padStart(2, '0');
            const b = parseInt(blueSlider.value).toString(16).padStart(2, '0');
            currentColor = `#${r}${g}${b}`.toUpperCase();
            colorPreview.style.backgroundColor = currentColor;
            hexDisplay.textContent = currentColor;
        }
        
        // Event listeners for sliders
        [redSlider, greenSlider, blueSlider].forEach(slider => {
            slider.addEventListener('input', () => {
                document.getElementById(`${slider.id}-value`).textContent = slider.value;
                updateColor();
            });
        });
        
        // Zoom functions
        function setZoom(newScale) {
            scale = Math.max(0.1, Math.min(10, newScale));
            zoomLevel.textContent = `${Math.round(scale * 100)}%`;
            updateCanvasTransform();
        }
        
        function updateCanvasTransform() {
            canvas.style.transform = `scale(${scale}) translate(${offsetX}px, ${offsetY}px)`;
        }
        
        document.getElementById('zoom-in').addEventListener('click', () => setZoom(scale * 1.2));
        document.getElementById('zoom-out').addEventListener('click', () => setZoom(scale / 1.2));
        
        // Panning
        container.addEventListener('mousedown', (e) => {
            if (e.button === 1 || (e.button === 0 && e.ctrlKey)) {
                isDragging = true;
                lastX = e.clientX;
                lastY = e.clientY;
                e.preventDefault();
            } else if (e.button === 0) {
                isDrawing = true;
                drawPixel(e);
            }
        });
        
        window.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const dx = e.clientX - lastX;
                const dy = e.clientY - lastY;
                offsetX += dx;
                offsetY += dy;
                lastX = e.clientX;
                lastY = e.clientY;
                updateCanvasTransform();
                e.preventDefault();
            } else if (isDrawing) {
                drawPixel(e);
            }
        });
        
        window.addEventListener('mouseup', () => {
            isDragging = false;
            isDrawing = false;
        });
        
        // Draw pixel
        function drawPixel(e) {
            if (!auth.currentUser) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left - offsetX * scale) / (BASE_PIXEL_SIZE * scale));
            const y = Math.floor((e.clientY - rect.top - offsetY * scale) / (BASE_PIXEL_SIZE * scale));
            
            if (x >= 0 && x < GRID_SIZE && y >= 0 && y < GRID_SIZE) {
                db.ref(`pixels/${x}_${y}`).set(currentColor);
                
                // Draw locally for immediate feedback
                ctx.fillStyle = currentColor;
                ctx.fillRect(
                    x * BASE_PIXEL_SIZE, 
                    y * BASE_PIXEL_SIZE, 
                    BASE_PIXEL_SIZE, 
                    BASE_PIXEL_SIZE
                );
            }
        }
        
        // Load pixels from Firebase
        db.ref('pixels').on('child_added', (snapshot) => {
            const [x, y] = snapshot.key.split('_').map(Number);
            const color = snapshot.val();
            ctx.fillStyle = color;
            ctx.fillRect(
                x * BASE_PIXEL_SIZE, 
                y * BASE_PIXEL_SIZE, 
                BASE_PIXEL_SIZE, 
                BASE_PIXEL_SIZE
            );
        });
        
        db.ref('pixels').on('child_changed', (snapshot) => {
            const [x, y] = snapshot.key.split('_').map(Number);
            const color = snapshot.val();
            ctx.fillStyle = color;
            ctx.fillRect(
                x * BASE_PIXEL_SIZE, 
                y * BASE_PIXEL_SIZE, 
                BASE_PIXEL_SIZE, 
                BASE_PIXEL_SIZE
            );
        });
        
        // Initialize
        updateColor();
        setZoom(1);
        
        // Simple auth - just sign in anonymously
        auth.signInAnonymously().catch(error => {
            console.error("Authentication error:", error);
        });
    </script>
</body>
</html>
